---
import SectionHeader from '../components/SectionHeader.astro';

const commands = [
  {
    name: 'run',
    description: 'Run a full deliberation from the terminal',
    example: 'concilium run "Refactor auth to use JWT tokens"',
    flags: [
      { flag: '--agents', desc: 'Choose agents (claude, codex, opencode)' },
      { flag: '--json', desc: 'Machine-readable output for pipelines' },
      { flag: '--output', desc: 'Save synthesis to a file' },
    ],
  },
  {
    name: 'history',
    description: 'Browse and replay past deliberations',
    example: 'concilium history --last --synthesis',
    flags: [
      { flag: '--last', desc: 'Show the most recent run' },
      { flag: '--synthesis', desc: 'Print only the final answer' },
      { flag: '--json', desc: 'Export as JSON' },
    ],
  },
  {
    name: 'config',
    description: 'Manage API keys, models, and preferences',
    example: 'concilium config set api-key sk-or-...',
    flags: [
      { flag: 'set api-key', desc: 'Store your OpenRouter key' },
      { flag: 'set jurors', desc: 'Default juror models' },
      { flag: 'set chairman', desc: 'Default chairman model' },
    ],
  },
  {
    name: 'models',
    description: 'Discover available models from agents and OpenRouter',
    example: 'concilium models --council',
    flags: [
      { flag: '--agent', desc: 'Filter by agent provider' },
      { flag: '--council', desc: 'Browse OpenRouter catalog' },
      { flag: '--json', desc: 'JSON output for scripting' },
    ],
  },
];
---

<section class="py-24 md:py-32" id="cli">
  <div class="max-w-7xl mx-auto px-6">
    <SectionHeader
      title="Terminal First"
      subtitle="CLI Interface"
      num="05"
    />

    <p class="text-lg text-text-secondary max-w-2xl mt-6 mb-16">
      Same deliberation engine, zero GUI required. Run pipelines from your terminal, pipe results to other tools, or embed Concilium in scripts with the programmatic API.
    </p>

    <!-- Hero terminal mockup -->
    <div class="mb-16 rounded-xl border border-border-primary bg-bg-page overflow-hidden shadow-2xl shadow-black/50">
      <!-- Title bar -->
      <div class="flex items-center gap-2 px-4 py-3 bg-white/[0.02] border-b border-white/5">
        <div class="flex gap-1.5">
          <div class="w-2.5 h-2.5 rounded-full bg-red-500/60"></div>
          <div class="w-2.5 h-2.5 rounded-full bg-yellow-500/60"></div>
          <div class="w-2.5 h-2.5 rounded-full bg-green-500/60"></div>
        </div>
        <span class="text-[10px] text-text-muted font-mono ml-2">~/my-project</span>
      </div>
      <!-- Terminal content -->
      <div class="p-6 font-mono text-sm leading-relaxed overflow-x-auto">
        <!-- Command -->
        <div class="flex items-center">
          <span class="select-none text-green-primary mr-2">$</span>
          <span class="text-text-primary">concilium run "Add rate limiting to the API endpoints"</span>
        </div>

        <!-- Stage 1 -->
        <div class="mt-4 text-text-muted text-xs">
          <span class="text-text-secondary font-semibold">Stage 1:</span> Parallel Execution
        </div>
        <div class="mt-2 space-y-1 ml-2">
          <div class="flex items-center gap-2">
            <span class="text-green-primary">&#x2713;</span>
            <span class="text-provider-opencode">opencode</span>
            <span class="text-text-muted">&#183; opencode-0</span>
            <span class="text-text-muted ml-auto text-xs">12.4s</span>
          </div>
          <div class="flex items-center gap-2">
            <span class="text-green-primary">&#x2713;</span>
            <span class="text-provider-claude">claude</span>
            <span class="text-text-muted">&#183; claude-opus-4</span>
            <span class="text-text-muted ml-auto text-xs">18.1s</span>
          </div>
          <div class="flex items-center gap-2">
            <span class="text-green-primary">&#x2713;</span>
            <span class="text-provider-codex">codex</span>
            <span class="text-text-muted">&#183; codex-mini</span>
            <span class="text-text-muted ml-auto text-xs">15.7s</span>
          </div>
        </div>

        <!-- Stage 2 -->
        <div class="mt-4 text-text-muted text-xs">
          <span class="text-text-secondary font-semibold">Stage 2:</span> Blind Peer Review
        </div>
        <div class="mt-2 space-y-1 ml-2">
          <div class="flex items-center gap-2">
            <span class="text-green-primary">&#x2713;</span>
            <span class="text-text-secondary">anthropic/claude-sonnet-4</span>
            <span class="text-text-muted ml-auto text-xs">complete</span>
          </div>
          <div class="flex items-center gap-2">
            <span class="text-green-primary">&#x2713;</span>
            <span class="text-text-secondary">openai/gpt-4.1</span>
            <span class="text-text-muted ml-auto text-xs">complete</span>
          </div>
          <div class="flex items-center gap-2">
            <span class="text-green-primary">&#x2713;</span>
            <span class="text-text-secondary">google/gemini-2.5-pro</span>
            <span class="text-text-muted ml-auto text-xs">complete</span>
          </div>
        </div>

        <!-- Stage 3 -->
        <div class="mt-4 text-text-muted text-xs">
          <span class="text-text-secondary font-semibold">Stage 3:</span> Synthesis
        </div>

        <!-- Divider -->
        <div class="mt-4 text-text-muted">
          <span class="text-green-primary">&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;</span>
          <span class="text-text-primary font-bold mx-2">SYNTHESIS</span>
          <span class="text-green-primary">&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;</span>
        </div>
        <div class="mt-2 text-text-secondary text-xs leading-relaxed">
          <p>The recommended approach combines a token bucket algorithm</p>
          <p>with Redis-backed distributed state. Key improvements from</p>
          <p class="flex items-center gap-1">
            the top-ranked response (Response A):
            <span class="inline-block w-1.5 h-3.5 bg-green-primary/80 animate-pulse"></span>
          </p>
        </div>

        <!-- Cost -->
        <div class="mt-4 pt-3 border-t border-white/5 text-xs text-text-muted">
          <span>Cost: $0.0847</span>
          <span class="mx-3">&#183;</span>
          <span>Run saved: a1b2c3d4-...</span>
        </div>
      </div>
    </div>

    <!-- Command cards -->
    <div class="grid md:grid-cols-2 gap-6">
      {commands.map((cmd) => (
        <div class="rounded-xl border border-border-primary bg-white/[0.02] p-6 hover:border-green-primary/30 transition-all duration-300 hover:scale-[1.01] backdrop-blur-sm">
          <div class="flex items-center gap-3 mb-3">
            <code class="text-green-primary font-mono font-bold text-sm">{cmd.name}</code>
            <span class="text-text-muted text-xs">&#8212;</span>
            <span class="text-text-secondary text-sm">{cmd.description}</span>
          </div>

          <!-- Example -->
          <div class="bg-bg-surface border border-border-secondary rounded-lg p-3 font-mono text-xs text-text-secondary overflow-x-auto mb-4">
            <div class="flex items-center">
              <span class="select-none text-green-primary/60 mr-2">$</span>
              <span class="text-text-primary">{cmd.example}</span>
            </div>
          </div>

          <!-- Flags -->
          <div class="space-y-2">
            {cmd.flags.map((f) => (
              <div class="flex items-start gap-3 text-xs">
                <code class="text-text-primary font-mono bg-white/5 px-1.5 py-0.5 rounded shrink-0">{f.flag}</code>
                <span class="text-text-muted">{f.desc}</span>
              </div>
            ))}
          </div>
        </div>
      ))}
    </div>

    <!-- Programmatic API -->
    <div class="mt-16 rounded-xl border border-border-primary bg-white/[0.02] p-8 backdrop-blur-sm">
      <div class="flex items-center gap-3 mb-2">
        <div class="w-8 h-8 rounded-full bg-provider-claude/10 border border-provider-claude/20 flex items-center justify-center">
          <span class="text-provider-claude text-xs font-bold font-mono">{`{}`}</span>
        </div>
        <h3 class="text-lg font-bold font-mono tracking-wide text-text-primary uppercase">Programmatic API</h3>
      </div>
      <p class="text-sm text-text-secondary mb-6 ml-11">
        Embed deliberations in scripts, CI pipelines, or agent skills with one function call.
      </p>

      <div class="bg-bg-surface border border-border-secondary rounded-lg p-5 font-mono text-sm overflow-x-auto">
        <div class="text-provider-codex/80">import</div>
        <div class="text-text-primary ml-2">{`{ deliberate }`} <span class="text-provider-codex/80">from</span> <span class="text-green-primary">'@concilium/cli'</span>;</div>
        <div class="mt-3 text-provider-codex/80">const</div>
        <div class="text-text-primary ml-2">result = <span class="text-provider-codex/80">await</span> <span class="text-text-primary">deliberate</span>({`{`}</div>
        <div class="text-text-secondary ml-4">prompt: <span class="text-green-primary">'Add error handling to the payment service'</span>,</div>
        <div class="text-text-secondary ml-4">agents: [{`{ provider: 'claude' }, { provider: 'opencode' }`}],</div>
        <div class="text-text-primary ml-2">{`}`});</div>
        <div class="mt-3 text-text-secondary">console.log(result.stage3?.response);</div>
      </div>
    </div>

  </div>
</section>
